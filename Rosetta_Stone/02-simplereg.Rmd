# Коан о простой линейной регрессии {#simplereg}

---
title: "Коан о простой линейной регрессии"
author: "Пуассон"
date: "3/2/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

<!-- Цвета для кусков кода 
<style>
pre.r {
    background-color: #81BEF7 !important;
}
pre.stata {
    background-color: #BDBDBD !important;
}
</style> -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Загрузим необходимые пакеты и импортируем данные. В качестве примера рассмотрим набор данных о месячных доходностях акций компаний США.
```{r, results='hide', message=FALSE, warning=FALSE}
library(tidyverse) # для манипуляций с данными и построения графиков
library(rio) # для чтения .dta файлов
library(car) # для линейных гипотез
df <- import(file = "us-return.dta")
```

Исследуем наш датасет.

```{r, results='hide', message=FALSE, warning=FALSE}
head(df) # первые 6 наблюдений
rename(df, n = A, date = B) # дадим столбцам осмысленные названия :)
sum(is.na(df)) # проверим наличие пропусков
df <- na.omit(df) # и избавмся от них
```

Будем верить в CAPM :) Оценим параметры модели для компании MOTOR. Соответсвенно, зависимая переменная - разница доходностей акций MOTOR и безрискового актива, а регрессор - рыночная премия.
```{r}
df <- mutate(df, y = MOTOR - RKFREE, x = MARKET - RKFREE)
ols <- lm(y ~ x, data = df)
summary(ols)
```


Визуализируем зависимость регрессора и зависимой переменной на графике.
```{r}
ggplot(df, aes(x, y)) +  geom_point(shape=1) + 
  geom_smooth(method=lm)
```

```{r}
linearHypothesis(ols, c("(Intercept) = 0", "x = 1"))
```