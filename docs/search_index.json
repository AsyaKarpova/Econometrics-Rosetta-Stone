[
["simplereg.html", "Коан 3 Коан о простой линейной регрессии", " Коан 3 Коан о простой линейной регрессии Построим простую линейную регрессию в R и проведем несложные тесты. Загрузим необходимые пакеты. library(tidyverse) # для манипуляций с данными и построения графиков library(skimr) #для красивого summary library(rio) # для чтения .dta файлов library(car) # для линейных гипотез library(tseries)# для теста на нормальность df = import(file = &quot;us-return.dta&quot;) Импортируем данные. df = import(file = &quot;us-return.dta&quot;) Исследуем наш датасет. #skim_with(numeric = list(hist = NULL)) skim(df) #посмотрим на наши данные Skim summary statistics n obs: 2664 n variables: 22 -- Variable type:character ----------------------------------------------------------------------------- variable missing complete n min max empty n_unique B 0 2664 2664 0 6 2544 31 -- Variable type:numeric ------------------------------------------------------------------------------- variable missing complete n mean sd p0 p25 p50 A 2544 120 2664 60.5 34.79 1 30.75 60.5 BOISE 2544 120 2664 0.017 0.097 -0.27 -0.045 0.015 CITCRP 2544 120 2664 0.012 0.081 -0.28 -0.037 0.011 CONED 2544 120 2664 0.019 0.05 -0.14 -0.012 0.019 CONTIL 2544 120 2664 -0.0011 0.15 -0.6 -0.051 0 DATGEN 2544 120 2664 0.0075 0.13 -0.34 -0.072 0.017 DEC 2544 120 2664 0.02 0.099 -0.36 -0.05 0.024 DELTA 2544 120 2664 0.012 0.096 -0.26 -0.053 0.013 GENMIL 2544 120 2664 0.017 0.065 -0.15 -0.026 0.011 GERBER 2544 120 2664 0.016 0.088 -0.29 -0.036 0.015 IBM 2544 120 2664 0.0096 0.059 -0.19 -0.029 0.002 MARKET 2544 120 2664 0.014 0.068 -0.26 -0.013 0.012 MOBIL 2544 120 2664 0.016 0.08 -0.18 -0.032 0.012 MOTOR 2544 120 2664 0.018 0.097 -0.33 -0.053 0.016 PANAM 2544 120 2664 0.0035 0.13 -0.31 -0.065 0 PSNH 2544 120 2664 -0.0042 0.11 -0.48 -0.048 0 rkfree 2544 120 2664 0.0068 0.0022 0.0021 0.0052 0.0066 RKFREE 2544 120 2664 0.0068 0.0022 0.0021 0.0052 0.0066 TANDY 2544 120 2664 0.025 0.13 -0.25 -0.058 0.022 TEXACO 2544 120 2664 0.012 0.08 -0.19 -0.037 0.01 WEYER 2544 120 2664 0.0096 0.085 -0.27 -0.048 -0.002 p75 p100 hist 90.25 120 &lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt; 0.07 0.38 &lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.064 0.32 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.045 0.15 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2582&gt;&lt;U+2582&gt; 0.058 0.97 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.078 0.53 &lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.075 0.38 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.063 0.29 &lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt; 0.06 0.19 &lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt; 0.065 0.23 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2582&gt;&lt;U+2581&gt; 0.05 0.15 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2583&gt;&lt;U+2582&gt; 0.062 0.15 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt; 0.057 0.37 &lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.084 0.27 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2581&gt; 0.074 0.41 &lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.043 0.32 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.0078 0.013 &lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2582&gt; 0.0078 0.013 &lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2582&gt; 0.094 0.45 &lt;U+2582&gt;&lt;U+2583&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.048 0.4 &lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt; 0.06 0.27 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt; df = rename(df, n = A, date = B) # дадим столбцам более осмысленные названия :) Будем верить в CAPM :) Оценим параметры модели для компании MOTOR. Соответственно, зависимая переменная - разница доходностей акций MOTOR и безрискового актива, а регрессор - рыночная премия. #создаем новые переменные и добавляем их к набору данных df &lt;- mutate(df, y = MOTOR - RKFREE, x = MARKET - RKFREE) Визуализируем зависимость регрессора и зависимой переменной. ggplot(df, aes(x = x, y = y)) + geom_point() + geom_smooth(method=lm) + labs(x = &quot;risk premium&quot;, y = &quot;return&quot;) Warning: Removed 2544 rows containing non-finite values (stat_smooth). Warning: Removed 2544 rows containing missing values (geom_point). Строим нашу модель и проверяем гипотезу об адекватности регрессии. ols &lt;- lm(y ~ x, data = df) summary(ols) Call: lm(formula = y ~ x, data = df) Residuals: Min 1Q Median 3Q Max -0.168421 -0.059381 -0.003399 0.061373 0.182991 Coefficients: Estimate Std. Error t value Pr(&gt;|t|) (Intercept) 0.005253 0.007200 0.730 0.467 x 0.848150 0.104814 8.092 5.91e-13 *** --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Residual standard error: 0.07844 on 118 degrees of freedom (2544 observations deleted due to missingness) Multiple R-squared: 0.3569, Adjusted R-squared: 0.3514 F-statistic: 65.48 on 1 and 118 DF, p-value: 5.913e-13 Проверим гипотезу о равенстве коэффициента при регрессии единице. linearHypothesis(ols, c(&quot;(Intercept) = 0&quot;, &quot;x = 1&quot;)) Linear hypothesis test Hypothesis: (Intercept) = 0 x = 1 Model 1: restricted model Model 2: y ~ x Res.Df RSS Df Sum of Sq F Pr(&gt;F) 1 120 0.74108 2 118 0.72608 2 0.014998 1.2187 0.2993 Сделаем предсказание по выборке. df &lt;- mutate(df, u_hat = resid(ols), y_hat = predict(ols), n = seq(dim(df)[1])) Error in mutate_impl(.data, dots): Column `u_hat` must be length 2664 (the number of rows) or one, not 120 Посмотрим на остатки :) Протестируем остатки регрессии на нормальность с помощью теста Харке-Бера. jarque.bera.test(df$u_hat) ##в R нет поправки на размер выборки Jarque Bera Test data: df$u_hat X-squared = NaN, df = 2, p-value = NA И тест Шапиро-Уилка. shapiro.test(df$u_hat) Error in shapiro.test(df$u_hat): is.numeric(x) не TRUE Оба теста указывают на нормальность распределения остатков регрессии. 3.0.0.1 То же самое в стате Загружаем данные, любуемся и даем новые названия столбцам. use us-return.dta summarize ren A n ren B date Variable | Obs Mean Std. Dev. Min Max -------------+-------------------------------------------------------- A | 120 60.5 34.78505 1 120 B | 0 MOBIL | 120 .0161917 .0803075 -.178 .366 TEXACO | 120 .0119417 .0797036 -.194 .399 IBM | 120 .0096167 .059024 -.187 .15 -------------+-------------------------------------------------------- DEC | 120 .01975 .0991438 -.364 .385 DATGEN | 120 .0074833 .1275399 -.342 .528 CONED | 120 .0185083 .0502719 -.139 .151 PSNH | 120 -.0042167 .1094712 -.485 .318 WEYER | 120 .0096333 .0850664 -.271 .27 -------------+-------------------------------------------------------- BOISE | 120 .016675 .0974882 -.274 .379 MOTOR | 120 .0181583 .0972656 -.331 .27 TANDY | 120 .0250083 .127566 -.246 .454 PANAM | 120 .0035167 .1318054 -.313 .406 DELTA | 120 .0116917 .0959317 -.26 .289 -------------+-------------------------------------------------------- CONTIL | 120 -.0011 .1506992 -.6 .974 CITCRP | 120 .0118583 .0809719 -.282 .318 GERBER | 120 .0164 .0877379 -.288 .234 GENMIL | 120 .0165833 .0650403 -.148 .19 MARKET | 120 .0139917 .0683532 -.26 .148 -------------+-------------------------------------------------------- RKFREE | 120 .0068386 .0021869 .00207 .01255 rkfree | 120 .0068386 .0021869 .00207 .01255 Убраем пропущенные значения и создаем новые переменные. drop if n==. gen y=MOTOR-RKFREE gen x=MARKET-RKFREE Визуализируем зависимость. graph twoway (lfit y x) (scatter y x) Строим модель и проверяем гипотезу об адекватности регрессии. reg y x Проверим гипотезу …. test _cons=0 x=1 Сделаем предсказание по выборке. predict u_hat, resid predict y_hat Протестируем остатки регрессии на нормальность с помощью теста Харке-Бера. sktest u_hat, noadjust #но все равно не как в R И тест Шапиро-Уилка. swilk u_hat "]
]
